# Adult Dataset

The aim of this dataset is to use census data (individualâ€™s education level, age, gender, occupation,...) to predict whether individual's income exceeds $50K/year or not.

## Preprocessing
- Drop following features: 'workclass', 'fnlwgt', 'education', 'marital-status', 'occupation',
          'relationship', 'capital-gain', 'capital-loss', 'hours-per-week', 'native-country'
- Map 'race', 'sex' and 'class' values to 0/1
          - ' White': 1, ' Amer-Indian-Eskimo': 0, ' Asian-Pac-Islander': 0, ' Black': 0, ' Other': 0
          - ' Male': 1, ' Female': 0
- Split 'age' and 'education' columns into multiple columns based on value
- Further details in ```adult_to_json.py``` and the ```get_adult_clear()``` functon.

## Setup Instructions
- From <https://www.kaggle.com/wenruliu/adult-income-dataset?select=adult.csv>, download the adult.csv file and put it in data/adult/data.
- Run ```python adult_to_json.py``` with the following options to do the preprocessing described above:
    - ```-num-workers``` := the number of workers you want to have in your federated learning task
    - ```-gan``` True/False := choose whether or not to use the 'simulated GAN' setup. A little subset of the dataset (supposed to be generated by a GAN) is shared among every worker.

- Run ```./preprocess.sh``` with a choice of the following tags:
    - ```--sf``` := fraction of data to sample, written as a decimal; default is 0.1
    - ```-k``` := minimum number of samples per user
    - ```-t``` := 'user' to partition users into train-test groups, or 'sample' to partition each user's samples into train-test groups
    - ```--tf``` := fraction of data in training set, written as a decimal; default is 0.9
    - ```--smplseed``` := seed to be used before random sampling of data
    - ```--spltseed``` :=  seed to be used before random split of data

i.e.
- ```./preprocess.sh -s niid --sf 1.0 -k 5 -t sample``` (full-sized dataset)<br/>

Make sure to delete the rem_user_data, sampled_data, test, and train subfolders in the data directory before re-running preprocess.sh

## Notes
- More details on i.i.d. versus non-i.i.d.:
  - TBD
- Each .json file is an object with 3 keys:
  1. 'users', a list of users
  2. 'num_samples', a list of the number of samples for each user, and 
  3. 'user_data', an object with user names as keys and their respective data as values; for each user, data is represented as a list of images, with each image represented as a size-784 integer list (flattened from 28 by 28)
- Run ```./stats.sh``` to get statistics of data (data/all_data/all_data.json must have been generated already)
- In order to run reference implementations in ```../models``` directory, the ```-t sample``` tag must be used when running ```./preprocess.sh```
