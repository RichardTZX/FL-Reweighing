# Compas Dataset

The dataset contains variables used by the COMPAS algorithm in scoring defendants, along with their outcomes within 2 years of the decision, for over 10,000 criminal defendants in Broward County, Florida. 

## Preprocessing
* Map 'sex' values to 0/1 based on underprivileged/privileged groups
* Filter out rows with values outside of specific ranges for 'days_b_screening_arrest', 'is_recid',
'c_charge_degree', 'score_text', 'race'
* Quantify length_of_stay from 'c_jail_out' and 'c_jail_in'
* Quanitfy 'priors-count', 'length_'age_cat', 'score_text', 'age_cat'
* Split 'age-cat', 'priors_count' and 'c_charge_degree' columns into multiple columns based on value
* Drop every other features
* Further details in ```compas_to_json.py``` and the ```get_compas_clear()``` functon.

## Setup Instructions
- From <https://github.com/propublica/compas-analysis/blob/master/compas-scores-two-years.csv>, download the compas-scores-two-years.csv file and put it in data/compas/data.
- Run ```python compas_to_json.py``` with the following options to do the preprocessing described above:
    - ```-num-workers``` := the number of workers you want to have in your federated learning task
    - ```-gan``` [OPTIONAL] integer n := choose whether or not to use the "simulated GAN" setup. A little subset of the dataset (supposed to be generated by a GAN) is shared among every worker. We take 'size' samples of each value of sensitive attributes in order to have diversity in the little subset of data. Therefore the subset's size is (4 * n) (in COMPAS we have two binary sensitive attributes hence 2*2 possibilities). 
    - ```-niid``` True/False := choose wether or not to use the "100/0 non-IID setup".
    - ```-sens-attr``` := choose the sensitive attribute to consider in your data generation task (useful only for the 100/0 non-IID setup; e.g race or sex/gender)

- Run ```./preprocess.sh``` with a choice of the following tags:
    - ```--sf``` := fraction of data to sample, written as a decimal; default is 0.1
    - ```-k``` := minimum number of samples per user
    - ```-t``` := 'user' to partition users into train-test groups, or 'sample' to partition each user's samples into train-test groups
    - ```--tf``` := fraction of data in training set, written as a decimal; default is 0.9
    - ```--smplseed``` := seed to be used before random sampling of data
    - ```--spltseed``` :=  seed to be used before random split of data

i.e.
- ```./preprocess.sh --sf 1.0 -k 0 -t sample``` (full-sized dataset)<br/>

Make sure to delete the rem_user_data, sampled_data, test, and train subfolders in the data directory before re-running preprocess.sh

## Notes
- More details on non-i.i.d. setup:
  - **Non-IID setup 100/0** : In the cross-device Federated Learning we will suppose that each device (a smartphone) is used by a single individual. Hence the local data of each device has the same value for sensitive attributes (a single race/gender) of every samples. The "non-IID setup **100/0**" refers to the setup in which every worker posseses samples with only one value of sensitive attributes (*if the sensitive attribute is binary* **100% samples** from one value and **0% samples** from the other value) 
- Each .json file is an object with 3 keys:
  1. 'users', a list of users
  2. 'num_samples', a list of the number of samples for each user, and 
  3. 'user_data', an object with user names as keys and their respective data as values; for each user, data is represented as a list containing the lists of 10 features for each sample.
- Run ```./stats.sh``` to get statistics of data (data/all_data/all_data.json must have been generated already)
- In order to run reference implementations in ```../models``` directory, the ```-t sample``` tag must be used when running ```./preprocess.sh```
